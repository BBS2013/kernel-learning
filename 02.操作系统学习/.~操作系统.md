ä»¥ä¸‹æ˜¯å¯¹æ“ä½œç³»ç»Ÿæ ¸å¿ƒæ¦‚å¿µçš„ç³»ç»Ÿæ€§è®²è§£ï¼Œç»“åˆç»å…¸æ•™æã€Šæ“ä½œç³»ç»Ÿæ¦‚å¿µï¼ˆç¬¬ä¸ƒç‰ˆï¼‰ã€‹çš„æ¡†æ¶ï¼Œåˆ†ä¸ºå…­ä¸ªéƒ¨åˆ†å¸®åŠ©æ‚¨å»ºç«‹å®Œæ•´çŸ¥è¯†ä½“ç³»ï¼š

------

### ä¸€ã€æ“ä½œç³»ç»Ÿçš„æœ¬è´¨ä¸æ ¸å¿ƒç›®æ ‡

**å®šä¹‰**
 æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰æ˜¯è®¡ç®—æœºç¡¬ä»¶ä¸ç”¨æˆ·/åº”ç”¨ç¨‹åºä¹‹é—´çš„â€‹**â€‹ä¸­ä»‹å±‚â€‹**â€‹ï¼Œæ ¸å¿ƒèŒè´£åŒ…æ‹¬ï¼š

1. **èµ„æºç®¡ç†è€…**ï¼šç»Ÿä¸€ç®¡æ§CPUã€å†…å­˜ã€I/Oè®¾å¤‡ç­‰ç¡¬ä»¶èµ„æºï¼ˆæ•™æ1.1.2èŠ‚ï¼‰
2. **æœåŠ¡æä¾›è€…**ï¼šä¸ºåº”ç”¨ç¨‹åºæä¾›æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹æ§åˆ¶ç­‰åŸºç¡€æœåŠ¡ï¼ˆç¬¬2ç« ï¼‰
3. **ç³»ç»Ÿä¿æŠ¤è€…**ï¼šé€šè¿‡éš”ç¦»æœºåˆ¶é˜²æ­¢ç¨‹åºè¶Šæƒè®¿é—®ç¡¬ä»¶ï¼ˆç¬¬14-15ç« ï¼‰

**åŒé‡è®¾è®¡ç›®æ ‡**

- **ç”¨æˆ·è§†è§’**ï¼šæå‡æ˜“ç”¨æ€§ï¼ˆå¦‚GUIç•Œé¢ã€APIæŠ½è±¡ï¼‰
- **ç³»ç»Ÿè§†è§’**ï¼šä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡ï¼ˆå¦‚å¤šä»»åŠ¡è°ƒåº¦ã€è™šæ‹ŸåŒ–æŠ€æœ¯ï¼‰

> *æ•™ææ¡ˆä¾‹*ï¼šæ‰‹æŒè®¾å¤‡OSéœ€å¹³è¡¡åŠŸè€—ä¸å“åº”é€Ÿåº¦ï¼ˆ1.11.3èŠ‚ï¼‰

------

# äºŒã€æ“ä½œç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½æ¨¡å—

# 1. è¿›ç¨‹ç®¡ç†ï¼ˆç¬¬3-7ç« ï¼‰

- **è¿›ç¨‹ vs çº¿ç¨‹**

  - è¿›ç¨‹ï¼šèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼ˆå«ä»£ç æ®µã€æ•°æ®æ®µã€PCBï¼‰
  - çº¿ç¨‹ï¼šCPUè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼ˆå…±äº«è¿›ç¨‹èµ„æºï¼‰

  > *å®ç°æ¨¡å‹*ï¼šWindows XPé‡‡ç”¨1:1çº¿ç¨‹æ¨¡å‹ï¼ˆ4.5.1èŠ‚ï¼‰


- **è¿›ç¨‹åŒæ­¥æœºåˆ¶**

  | æœºåˆ¶     | åŸç†                       | å…¸å‹åº”ç”¨          |
  | -------- | -------------------------- | ----------------- |
  | ä¿¡å·é‡   | P/VåŸå­æ“ä½œæ§åˆ¶èµ„æºè®¿é—®    | ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ |
  | ç®¡ç¨‹     | å°è£…åŒæ­¥æ“ä½œçš„æŠ½è±¡æ•°æ®ç±»å‹ | JavaåŒæ­¥å—        |
  | åŸå­äº‹åŠ¡ | ACIDç‰¹æ€§ä¿è¯æ“ä½œåŸå­æ€§     | æ•°æ®åº“ç³»ç»Ÿ        |

## 1.1è¿›ç¨‹é—´æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Ÿå¯ä»¥å†™å‡ ä¸ªä¾‹å­ç»™æˆ‘çœ‹çœ‹ã€‚

wslï¼šcd  "/mnt/c/program file"



## 1.2å…±äº«å†…å­˜é€šä¿¡

åœ¨ C++ ä¸­ï¼Œä½¿ç”¨ **System V å…±äº«å†…å­˜**ï¼ˆSystem V Shared Memoryï¼‰æ˜¯ä¸€ç§å¸¸è§çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å…±äº«å†…å­˜é€šä¿¡ç¤ºä¾‹ï¼Œåˆ†ä¸ºä¸¤ä¸ªç¨‹åºï¼š

- `server.cpp`ï¼šåˆ›å»ºå…±äº«å†…å­˜å¹¶å†™å…¥æ•°æ®ï¼›
- `client.cpp`ï¼šè¿æ¥åˆ°å…±äº«å†…å­˜å¹¶è¯»å–æ•°æ®ã€‚

---

### âœ… ç¤ºä¾‹ç›®æ ‡

- ä½¿ç”¨å…±äº«å†…å­˜è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼›
- `server` å†™å…¥æ•°æ®ï¼›
- `client` è¯»å–æ•°æ®ï¼›
- ä½¿ç”¨ `sleep(2)` æ¨¡æ‹ŸåŒæ­¥ï¼ˆç®€å•åœºæ™¯ä¸‹ä½¿ç”¨ï¼‰ï¼›
- ä½¿ç”¨æ ‡å‡†çš„ System V å…±äº«å†…å­˜æ¥å£ï¼ˆPOSIX ä¹Ÿå¯ä»¥ï¼Œä½†æ­¤å¤„ç”¨ System Vï¼‰ã€‚

---

### ğŸ“ æ–‡ä»¶ç»“æ„

```
shared_memory_example/
â”œâ”€â”€ server.cpp
â”œâ”€â”€ client.cpp
```

---

## ğŸŸ¦ server.cpp

```cpp
#include <iostream>
#include <cstdlib>
#include <cstring>
#include <sys/ipc.h>
#include <sys/shm.h>
#include <unistd.h>  // for sleep()

#define SHM_KEY 1234
#define SHM_SIZE 1024

int main() {
    // åˆ›å»ºå…±äº«å†…å­˜æ®µ
    int shmid = shmget(SHM_KEY, SHM_SIZE, IPC_CREAT | 0666);
    if (shmid == -1) {
        perror("shmget failed");
        return 1;
    }

    // å°†å…±äº«å†…å­˜é™„åŠ åˆ°å½“å‰è¿›ç¨‹
    char *shm = (char *)shmat(shmid, nullptr, 0);
    if (shm == (char *)-1) {
        perror("shmat failed");
        return 1;
    }

    // å†™å…¥æ•°æ®
    const char *message = "Hello from shared memory!";
    strcpy(shm, message);
    std::cout << "Server: Wrote message to shared memory." << std::endl;

    // ç­‰å¾…å®¢æˆ·ç«¯è¯»å–
    sleep(2);

    // åˆ†ç¦»å…±äº«å†…å­˜
    if (shmdt(shm) == -1) {
        perror("shmdt failed");
        return 1;
    }

    // åˆ é™¤å…±äº«å†…å­˜
    if (shmctl(shmid, IPC_RMID, nullptr) == -1) {
        perror("shmctl(IPC_RMID) failed");
        return 1;
    }

    return 0;
}
```

---

## ğŸŸ© client.cpp

```cpp
#include <iostream>
#include <cstdlib>
#include <cstring>
#include <sys/ipc.h>
#include <sys/shm.h>

#define SHM_KEY 1234
#define SHM_SIZE 1024

int main() {
    // è·å–å…±äº«å†…å­˜æ®µ
    int shmid = shmget(SHM_KEY, SHM_SIZE, 0666);
    if (shmid == -1) {
        perror("shmget failed");
        return 1;
    }

    // å°†å…±äº«å†…å­˜é™„åŠ åˆ°å½“å‰è¿›ç¨‹
    char *shm = (char *)shmat(shmid, nullptr, 0);
    if (shm == (char *)-1) {
        perror("shmat failed");
        return 1;
    }

    // è¯»å–æ•°æ®
    std::cout << "Client: Read from shared memory: " << shm << std::endl;

    // åˆ†ç¦»å…±äº«å†…å­˜
    if (shmdt(shm) == -1) {
        perror("shmdt failed");
        return 1;
    }

    return 0;
}
```

---

## ğŸ›  ç¼–è¯‘ä¸è¿è¡Œ

### ç¼–è¯‘ï¼š

```bash
g++ server.cpp -o server
g++ client.cpp -o client
```

### è¿è¡Œï¼š

1. å…ˆè¿è¡Œ `server`ï¼š
   ```bash
   ./server
   ```

2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œ `client`ï¼š
   ```bash
   ./client
   ```

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

- **åŒæ­¥é—®é¢˜**ï¼šæ­¤ç¤ºä¾‹ä¸­é€šè¿‡ `sleep(2)` å®ç°åŒæ­¥ï¼Œä»…é€‚ç”¨äºæ•™å­¦æ¼”ç¤ºã€‚å®é™…ç”Ÿäº§ç¯å¢ƒä¸­åº”ä½¿ç”¨ä¿¡å·é‡ï¼ˆsemaphoreï¼‰æˆ–å…¶å®ƒåŒæ­¥æœºåˆ¶ã€‚
- **å…±äº«å†…å­˜æ¸…ç†**ï¼šè‹¥ `server` å¼‚å¸¸ç»ˆæ­¢ï¼Œå¯èƒ½æ®‹ç•™å…±äº«å†…å­˜ã€‚å¯ä½¿ç”¨ `ipcs -m` æŸ¥çœ‹ï¼Œ`ipcrm -m <shmid>` åˆ é™¤ã€‚
- **æƒé™é—®é¢˜**ï¼šç¡®ä¿è¿è¡Œç”¨æˆ·å¯¹å…±äº«å†…å­˜æœ‰æƒé™ï¼ˆ0666 è¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·å¯è¯»å†™ï¼‰ã€‚
- **è·¨å¹³å°å…¼å®¹æ€§**ï¼šSystem V å…±äº«å†…å­˜ä¸»è¦åœ¨ Linux ä¸Šä½¿ç”¨ï¼ŒWindows ä¸‹é€šå¸¸ä½¿ç”¨å…¶ä»– IPC æœºåˆ¶ï¼ˆå¦‚ Memory Mapped Filesï¼‰ã€‚

---

## âœ… è¾“å‡ºç¤ºä¾‹

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```
Server: Wrote message to shared memory.
Client: Read from shared memory: Hello from shared memory!
```

---

## ğŸ§© å»¶ä¼¸å»ºè®®

- åŠ å…¥ä¿¡å·é‡å®ç°è¯»å†™åŒæ­¥ï¼›
- ä½¿ç”¨ç»“æ„ä½“ä¼ é€’å¤æ‚æ•°æ®ï¼›
- ä½¿ç”¨ `ftok()` ç”Ÿæˆæ›´ç¨³å®šçš„ keyï¼›
- å°è¯•ä½¿ç”¨ POSIX å…±äº«å†…å­˜ï¼ˆ`shm_open()` + `mmap()`ï¼‰å®ç°è·¨å¹³å°æ”¯æŒã€‚

---

å¦‚æœä½ å¸Œæœ›æˆ‘æä¾› **POSIX ç‰ˆæœ¬** æˆ– **Windows ä¸Šçš„å…±äº«å†…å­˜å®ç°**ï¼Œä¹Ÿå¯ä»¥ç»§ç»­å‘Šè¯‰æˆ‘ï¼



#### 2. å†…å­˜ç®¡ç†ï¼ˆç¬¬8-9ç« ï¼‰

- **æ ¸å¿ƒé—®é¢˜**ï¼šè§£å†³æœ‰é™ç‰©ç†å†…å­˜ vs æ— é™ç¨‹åºéœ€æ±‚çš„çŸ›ç›¾

- 

  å…³é”®æŠ€æœ¯æ¼”è¿›

  ï¼š

  ```
  graph LR
  A[è¿ç»­åˆ†é…] --> B[å¤–éƒ¨ç¢ç‰‡é—®é¢˜]
  B --> C[åˆ†é¡µæœºåˆ¶]
  C --> D[è™šæ‹Ÿå†…å­˜]
  D --> E[æŒ‰éœ€è°ƒé¡µ+é¡µé¢ç½®æ¢]
  ```

- **è™šæ‹Ÿå†…å­˜åˆ›æ–°**ï¼šå†™æ—¶å¤åˆ¶ï¼ˆCopy-on-Writeï¼‰æŠ€æœ¯å‡å°‘è¿›ç¨‹forkå¼€é”€ï¼ˆ9.3èŠ‚ï¼‰

#### 3. å­˜å‚¨ç®¡ç†ï¼ˆç¬¬10-13ç« ï¼‰

- 

  æ–‡ä»¶ç³»ç»ŸåŒå±‚æŠ½è±¡

  ï¼š

  - é€»è¾‘å±‚ï¼šæ ‘çŠ¶ç›®å½•ç»“æ„ï¼ˆ10.3.5èŠ‚ï¼‰
  - ç‰©ç†å±‚ï¼šç£ç›˜å—åˆ†é…ç­–ç•¥ï¼ˆè¿ç»­/é“¾å¼/ç´¢å¼•ï¼‰

- 

  ç£ç›˜è°ƒåº¦ç®—æ³•å¯¹æ¯”

  ï¼š

  | ç®—æ³• | ç‰¹ç‚¹                 | é€‚ç”¨åœºæ™¯     |
  | ---- | -------------------- | ------------ |
  | FCFS | ç®€å•å…¬å¹³ï¼Œå¯»é“æ—¶é—´é•¿ | è´Ÿè½½è¾ƒè½»ç³»ç»Ÿ |
  | SSTF | æœ€å°å¯»é“æ—¶é—´ä¼˜å…ˆ     | æ˜“è‡´é¥¥é¥¿ç°è±¡ |
  | SCAN | ç”µæ¢¯æ‰«æï¼Œæ— é¥¥é¥¿     | é«˜è´Ÿè½½ç³»ç»Ÿ   |

#### 4. ä¿æŠ¤ä¸å®‰å…¨ï¼ˆç¬¬14-15ç« ï¼‰

- 

  è®¿é—®æ§åˆ¶çŸ©é˜µ

  ï¼ˆ14.4èŠ‚ï¼‰ï¼š

  ```
  +---------+------+-------+-------+
  | ä¸»ä½“/å®¢ä½“| æ–‡ä»¶A| å†…å­˜B | è®¾å¤‡C |
  +---------+------+-------+-------+
  | ç”¨æˆ·X   | è¯»   | æ‰§è¡Œ  | -      |
  | è¿›ç¨‹Y   | è¯»å†™ | -     | æ§åˆ¶   |
  +---------+------+-------+-------+
  ```

- 

  å®‰å…¨å¨èƒé˜²æŠ¤

  ï¼š

  - ç¼“å†²åŒºæº¢å‡ºé˜²å¾¡ï¼šæ ˆéšæœºåŒ–ï¼ˆASLRï¼‰ã€ä¸å¯æ‰§è¡Œæ ˆï¼ˆNX bitï¼‰
  - è®¤è¯æœºåˆ¶ï¼šç”Ÿç‰©è¯†åˆ«ï¼ˆ15.5.5èŠ‚ï¼‰

------

### ä¸‰ã€ç°ä»£æ“ä½œç³»ç»Ÿæ¼”è¿›æ–¹å‘

#### 1. åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆç¬¬16-18ç« ï¼‰

- **æ ¸å¿ƒæŒ‘æˆ˜**ï¼šç½‘ç»œå»¶è¿Ÿã€éƒ¨åˆ†æ•…éšœã€æ—¶é’ŸåŒæ­¥
- **ä¸€è‡´æ€§åè®®**ï¼šä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆ18.3èŠ‚ï¼‰

#### 2. å®æ—¶åµŒå…¥å¼ç³»ç»Ÿï¼ˆç¬¬19ç« ï¼‰

- **å…³é”®æŒ‡æ ‡**ï¼šæ—¶é™ï¼ˆDeadlineï¼‰ä¿éšœ

- 

  è°ƒåº¦ç®—æ³•

  ï¼š

  - å•è°ƒé€Ÿç‡ï¼ˆRMSï¼‰â†’ å‘¨æœŸæ€§ä»»åŠ¡
  - æœ€æ—©æˆªæ­¢æœŸä¼˜å…ˆï¼ˆEDFï¼‰â†’ åŠ¨æ€ä¼˜å…ˆçº§è°ƒæ•´

#### 3. å¤šåª’ä½“ç³»ç»Ÿï¼ˆç¬¬20ç« ï¼‰

- 

  QoSä¿éšœæœºåˆ¶

  ï¼š

  - ç£ç›˜è°ƒåº¦ï¼šSCAN-EDFæ··åˆç®—æ³•ï¼ˆ20.5.2èŠ‚ï¼‰
  - ç½‘ç»œä¼ è¾“ï¼šRSVPåè®®é¢„ç•™å¸¦å®½ï¼ˆ20.6èŠ‚ï¼‰

------

### å››ã€ç»å…¸æ“ä½œç³»ç»Ÿå®ç°å¯¹æ¯”

| ç³»ç»Ÿ       | å†…æ ¸æ¶æ„      | åˆ›æ–°æŠ€æœ¯           | æ•™æç« èŠ‚ |
| ---------- | ------------- | ------------------ | -------- |
| Linux      | å®å†…æ ¸+æ¨¡å—åŒ– | Ext2æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ   | ç¬¬21ç«    |
| Windows XP | æ··åˆå†…æ ¸      | NTFSäº‹åŠ¡æ¢å¤æœºåˆ¶   | ç¬¬22ç«    |
| Mach       | å¾®å†…æ ¸        | åŸºäºç«¯å£çš„å®‰å…¨é€šä¿¡ | é™„å½•A    |

------

### äº”ã€å­¦ä¹ æ“ä½œç³»ç»Ÿçš„æ–¹æ³•è®º

1. 

   ç†è®º-å®è·µå¾ªç¯

   ï¼š

   - é€šè¿‡ç¼–ç¨‹é¡¹ç›®ç†è§£æ¦‚å¿µï¼ˆå¦‚å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ï¼‰

2. 

   è·¨å±‚æ€ç»´

   ï¼š

   - ç†è§£ä»ç¡¬ä»¶ä¸­æ–­ï¼ˆ13.2èŠ‚ï¼‰åˆ°ç³»ç»Ÿè°ƒç”¨ï¼ˆ2.3èŠ‚ï¼‰çš„å®Œæ•´è·¯å¾„

3. 

   æ¼”è¿›è§†è§’

   ï¼š

   - å¯¹æ¯”æ—©æœŸæ‰¹å¤„ç†ç³»ç»Ÿï¼ˆ23.1èŠ‚ï¼‰ä¸ç°ä»£äº‘åŸç”ŸOSçš„å¼‚åŒ

> **æ•™æç‰¹åˆ«æç¤º**ï¼šç¬¬ä¸ƒç‰ˆæ–°å¢15+å®æˆ˜é¡¹ç›®ï¼ˆå¦‚Linuxç³»ç»Ÿè°ƒç”¨æ‰©å±•ï¼‰ï¼Œå»ºè®®ç»“åˆPOSIX/Win32 APIå®è·µï¼ˆå‰è¨€â€œç¼–ç¨‹ç»ƒä¹ â€éƒ¨åˆ†ï¼‰

------

### å…­ã€å…³é”®é—®é¢˜æ€è€ƒ

1. ä¸ºä½•ç°ä»£OSæ™®éé‡‡ç”¨**åˆ†é¡µå¼å†…å­˜ç®¡ç†**è€Œéåˆ†æ®µå¼ï¼Ÿï¼ˆ8.6èŠ‚ï¼‰
2. **å¤šæ ¸å¤„ç†å™¨**å¦‚ä½•å½±å“è°ƒåº¦ç®—æ³•è®¾è®¡ï¼Ÿï¼ˆ5.4èŠ‚è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰
3. **å®¹å™¨æŠ€æœ¯**ï¼ˆå¦‚Dockerï¼‰ä¸ä¼ ç»Ÿè™šæ‹Ÿæœºçš„æœ¬è´¨åŒºåˆ«ï¼Ÿï¼ˆ2.8èŠ‚è™šæ‹ŸæœºåŸç†ï¼‰

æ­¤æ¡†æ¶è¦†ç›–æ“ä½œç³»ç»Ÿæ ¸å¿ƒçŸ¥è¯†ä½“ç³»ï¼Œå»ºè®®ç»“åˆæ•™æå…·ä½“ç« èŠ‚æ·±åŒ–ç†è§£ã€‚åç»­å¯é’ˆå¯¹ä»»ä¸€æ¨¡å—å±•å¼€è¯¦ç»†è®¨è®ºã€‚